<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reproduce Photo Upload Error</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 10px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      padding: 40px;
      max-width: 700px;
      width: 100%;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    h1 {
      color: #333;
      font-size: 24px;
      margin-bottom: 5px;
    }

    .subtitle {
      color: #666;
      font-size: 14px;
      margin-bottom: 20px;
    }

    .warning-box {
      background: #fff3cd;
      border: 2px solid #ffc107;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 20px;
      color: #856404;
    }

    .info-box {
      background: #cfe2ff;
      border: 2px solid #0d6efd;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 20px;
      color: #084298;
      font-size: 13px;
    }

    .code-block {
      background: #f5f5f5;
      border-left: 4px solid #dc3545;
      padding: 10px;
      margin: 10px 0;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      overflow-x: auto;
    }

    .comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    .comparison-box {
      padding: 15px;
      border-radius: 6px;
    }

    .broken {
      background: #f8d7da;
      border: 2px solid #dc3545;
    }

    .working {
      background: #d4edda;
      border: 2px solid #28a745;
    }

    .comparison-box h3 {
      margin-bottom: 10px;
      font-size: 14px;
    }

    .comparison-box code {
      display: block;
      background: white;
      padding: 10px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      line-height: 1.4;
      overflow-x: auto;
    }

    .steps {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 20px;
      margin: 20px 0;
    }

    .steps h3 {
      color: #333;
      margin-bottom: 15px;
      font-size: 16px;
    }

    .step {
      margin-bottom: 15px;
      padding-left: 30px;
      position: relative;
    }

    .step::before {
      content: attr(data-number);
      position: absolute;
      left: 0;
      top: 0;
      background: #667eea;
      color: white;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 12px;
    }

    .step-title {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }

    .step-content {
      color: #666;
      font-size: 14px;
      line-height: 1.5;
    }

    .error-display {
      background: #ffe0e0;
      border: 2px solid #ff0000;
      border-radius: 6px;
      padding: 15px;
      margin: 20px 0;
      font-family: 'Courier New', monospace;
    }

    .error-title {
      color: #cc0000;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .error-message {
      color: #990000;
      font-size: 13px;
      line-height: 1.5;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 15px;
      transition: transform 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .diagram {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 15px;
      margin: 20px 0;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.6;
      overflow-x: auto;
    }

    .console-output {
      background: #222;
      color: #0f0;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.5;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üî¥ Reproduce Photo Upload Error</h1>
      <p class="subtitle">See exactly how the "Failed to fetch" error happens</p>
    </div>

    <div class="warning-box">
      ‚ö†Ô∏è <strong>This demonstrates a BROKEN scenario</strong>
      <br>This page uses HARDCODED production URL (the bug)
      <br>In production, use the FIXED version with auto-detection
    </div>

    <div class="info-box">
      üìç <strong>Current Setup:</strong>
      <br>
      This page is served from: <strong id="currentUrl">http://localhost:5000/</strong>
      <br>
      API pointing to: <strong id="apiUrl">https://ice-commite-registration.onrender.com</strong>
      <br>
      <strong style="color: #0c5460;">This mismatch causes the error!</strong>
    </div>

    <div class="steps">
      <h3>üéØ How to Reproduce the Error</h3>
      
      <div class="step" data-number="1">
        <div class="step-title">Start Backend Server</div>
        <div class="step-content">
          In terminal:
          <div class="code-block">
cd /home/noor-abdullah/Desktop/ICPC_MOCK/backend
node server.js
          </div>
          <strong>Expected:</strong> "üöÄ Server running on http://localhost:5000"
        </div>
      </div>

      <div class="step" data-number="2">
        <div class="step-title">Open Developer Tools</div>
        <div class="step-content">
          Press <strong>F12</strong> on your keyboard
          <br>Go to <strong>Console tab</strong>
          <br>You'll see the logs in real-time
        </div>
      </div>

      <div class="step" data-number="3">
        <div class="step-title">Verify Hardcoded URL</div>
        <div class="step-content">
          In console, type:
          <div class="code-block">
console.log(API_URL);
          </div>
          <strong>You should see:</strong>
          <div class="console-output" style="color: #ff6b6b;">
https://ice-commite-registration.onrender.com
          </div>
          This is the PROBLEM - pointing to production!
        </div>
      </div>

      <div class="step" data-number="4">
        <div class="step-title">Click the Test Button Below</div>
        <div class="step-content">
          The button will simulate submitting a photo.
          <br>
          Watch the console for errors.
          <br>
          You'll see: <strong style="color: #cc0000;">‚ùå Photo upload failed: Failed to fetch</strong>
        </div>
      </div>
    </div>

    <button onclick="simulatePhotoUpload()" id="testBtn">
      ‚ñ∂Ô∏è Click to Reproduce Error
    </button>

    <div id="errorDisplay" style="display: none;">
      <div class="error-display">
        <div class="error-title">üî¥ ERROR REPRODUCED</div>
        <div class="error-message" id="errorContent"></div>
      </div>
    </div>

    <div class="steps" style="margin-top: 40px;">
      <h3>üìä Understanding the Error</h3>

      <div class="diagram">
Browser at: http://localhost:5000/
         ‚Üì
JavaScript tries to upload photo to:
https://ice-commite-registration.onrender.com/api/upload
         ‚Üì
Browser checks: "Same origin?"
         ‚Üì
NO! localhost:5000 ‚â† onrender.com
         ‚Üì
Browser blocks request (CORS Policy)
         ‚Üì
‚ùå "Failed to fetch" error returned
      </div>

      <div class="comparison">
        <div class="comparison-box broken">
          <h3>‚ùå BROKEN (Hardcoded)</h3>
          <code>const API_URL = 
'https://ice-commite-...
onrender.com';

// Always production!
// Doesn't work in dev</code>
        </div>
        <div class="comparison-box working">
          <h3>‚úÖ WORKING (Auto-detect)</h3>
          <code>const API_URL = 
window.location.hostname
=== 'localhost'
  ? 'http://localhost:5000'
  : 'https://...onrender.com';</code>
        </div>
      </div>
    </div>

    <div class="info-box" style="margin-top: 30px;">
      ‚ÑπÔ∏è <strong>After reproducing this error:</strong>
      <br>
      The fix is already applied in your codebase!
      <br>
      All frontend files now use auto-detection.
      <br>
      Photo uploads work perfectly in development.
    </div>
  </div>

  <script>
    // INTENTIONALLY HARDCODED TO PRODUCTION (The Bug)
    const API_URL = 'https://ice-commite-registration.onrender.com';

    console.log('üåê API URL:', API_URL);
    console.log('üìç Current Page:', window.location.hostname);
    console.log('‚ö†Ô∏è PROBLEM: Hardcoded to production, not localhost!');

    document.getElementById('currentUrl').textContent = window.location.href;
    document.getElementById('apiUrl').textContent = API_URL;

    async function simulatePhotoUpload() {
      const errorDisplay = document.getElementById('errorDisplay');
      const errorContent = document.getElementById('errorContent');
      const testBtn = document.getElementById('testBtn');

      console.log('%c--- Starting Photo Upload Test ---', 'color: blue; font-weight: bold;');
      console.log('üì§ Attempting to upload photo...');
      console.log(`Browser at: ${window.location.hostname}:${window.location.port}`);
      console.log(`API URL: ${API_URL}`);
      
      testBtn.disabled = true;
      testBtn.textContent = '‚è≥ Testing...';

      try {
        console.log('Creating test image...');
        
        // Create a small test image
        const canvas = document.createElement('canvas');
        canvas.width = 100;
        canvas.height = 100;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = 'blue';
        ctx.fillRect(0, 0, 100, 100);
        
        canvas.toBlob(async (blob) => {
          const formData = new FormData();
          formData.append('photo', blob, 'test.jpg');

          console.log(`%cüì° Sending request to: ${API_URL}/api/upload`, 'color: orange;');
          console.log('‚ö†Ô∏è This is different from browser origin!');
          console.log('‚ö†Ô∏è Browser will block this cross-origin request...');

          try {
            const response = await fetch(`${API_URL}/api/upload`, {
              method: 'POST',
              body: formData
            });

            console.log('‚úÖ Request succeeded (unexpected)');
            const data = await response.json();
            console.log('Response:', data);
            
          } catch (error) {
            console.error('%c‚ùå FETCH FAILED!', 'color: red; font-weight: bold;');
            console.error(`Error: ${error.message}`);
            console.error('Stack:', error.stack);

            const errorMsg = `
‚ùå Registration failed: Photo upload failed: Failed to fetch

Reason:
- Browser: ${window.location.hostname}
- API URL: ${API_URL}
- Origin Mismatch: Cross-origin request blocked!

Error Details:
${error.message}

This is the exact error users would see!
            `;

            errorContent.innerHTML = `
              <strong>‚ùå Registration failed: Photo upload failed: Failed to fetch</strong>
              <br><br>
              <strong>Browser Console:</strong>
              <div class="console-output">
> console.log(API_URL);
"${API_URL}"

> fetch(\`\${API_URL}/api/upload\`)
‚ùå TypeError: Failed to fetch
              </div>
              <br>
              <strong>Reason:</strong> Frontend is hardcoded to production URL, but running on localhost
              <br><strong>Browser blocks this cross-origin request for security (CORS)</strong>
            `;

            errorDisplay.style.display = 'block';
            errorDisplay.scrollIntoView({ behavior: 'smooth' });
          }

          testBtn.disabled = false;
          testBtn.textContent = '‚ñ∂Ô∏è Click to Reproduce Error';
        });

      } catch (error) {
        console.error('Test error:', error);
        testBtn.disabled = false;
        testBtn.textContent = '‚ñ∂Ô∏è Click to Reproduce Error';
      }
    }

    // Initial console messages
    console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: blue;');
    console.log('%cüî¥ BROKEN SCENARIO - Photo Upload Error', 'color: red; font-weight: bold; font-size: 14px;');
    console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: blue;');
    console.log('');
    console.log('%cThis page demonstrates the ERROR:', 'color: red; font-weight: bold;');
    console.log('Frontend is hardcoded to production URL');
    console.log('Running on development environment (localhost)');
    console.log('Cross-origin request will be blocked');
    console.log('');
    console.log('Click the button below to trigger the error!');
    console.log('');
  </script>
</body>
</html>
